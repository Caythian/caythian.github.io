---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { generateSlug } from "../../lib/utils";

export async function getStaticPaths() {
  const artworks = await getCollection("artworks");
  return artworks.map((entry) => ({
    params: { id: generateSlug(entry.data.title, entry.id) },
    props: { artwork: entry },
  }));
}

const { artwork } = Astro.props;
const { data } = artwork;

// Ensure detail images are properly processed - extract src from Image objects
const detailImages = data.details?.map((img: any) => img?.src || img) || [];
---

<Layout title={`${data.title} - Xuecong Wang`}>
  <div class="artwork-page">
      <div class="artwork-container">
        <div class="artwork-images">
          <div class="main-image">
            <img src={data.image.src} alt={data.title} />
          </div>
          {detailImages.length > 0 && (
            <div class="detail-images">
              {detailImages.map((imgSrc: string, index: number) => (
                <img
                  key={index}
                  src={imgSrc}
                  alt={`${data.title} detail ${index + 1}`}
                />
              ))}
            </div>
          )}
        </div>

        <div class="artwork-info">
          <h1 class="artwork-title">{data.title}</h1>
          {data.time && <p class="artwork-time">Time: {data.time}</p>}
          {data.medium && (
            <p class="artwork-medium">Medium: {data.medium}</p>
          )}
          {data.dimension && (
            <p class="artwork-dimension">Dimension: {data.dimension}</p>
          )}
          <p class="artwork-category">Category: {data.category}</p>

          {data.description && (
            <div class="artwork-description">
              <h2>Description:</h2>
              {Array.isArray(data.description) ? (
                data.description.map((line: string) => (
                  <p>{line}</p>
                ))
              ) : (
                <p>{data.description}</p>
              )}
            </div>
          )}
        </div>
      </div>
    </div>
</Layout>
