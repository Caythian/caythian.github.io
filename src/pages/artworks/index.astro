---
import { getCollection } from "astro:content";
import Starter from "../../components/Starter.astro";
import StaticArtworkGallery from "../../components/StaticArtworkGallery";
import Layout from "../../layouts/Layout.astro";
import type { Artwork } from "../../types";

const artworksCollection = await getCollection("artworks");

// Map collection to Artwork type
const artworks: Artwork[] = artworksCollection.map((entry) => {
  // Extract detail image URLs - handle both Image objects and strings
  const details = entry.data.details
    ? entry.data.details
        .map((img: any) => {
          if (typeof img === 'string') return img;
          if (img && typeof img === 'object' && img.src) return img.src;
          return null;
        })
        .filter((url: string | null): url is string => Boolean(url))
    : undefined;

  return {
    id: entry.id,
    title: entry.data.title,
    category: entry.data.category,
    image: entry.data.image.src,
    time: entry.data.time,
    medium: entry.data.medium,
    dimension: entry.data.dimension,
    description: entry.data.description,
    details,
  };
});

// Sort artworks by time in reverse chronological order (newest first)
artworks.sort((a, b) => {
  // Handle undefined time values - put them at the end
  if (!a.time && !b.time) return 0;
  if (!a.time) return 1;
  if (!b.time) return -1;
  
  // Parse time as number for comparison (e.g., "2025" -> 2025)
  const timeA = parseInt(a.time, 10) || 0;
  const timeB = parseInt(b.time, 10) || 0;
  
  // Reverse chronological: newer (larger number) comes first
  return timeB - timeA;
});
---

<Layout title="Artworks - Xuecong Wang">
  <Starter />
  <StaticArtworkGallery artworks={artworks} client:load />
</Layout>

